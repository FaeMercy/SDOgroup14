worker_processes 1;
events { worker_connections 1024; }

http {
  upstream api { server server-service:3000; }
  upstream web { server client-service:80; }

  server {
    listen 80;
    server_name localhost;
    location / { return 301 https://$host$request_uri; }
  }

  server {
    listen 443 ssl;
    server_name localhost;
    ssl_certificate     /etc/ssl/certs/localhost.crt;
    ssl_certificate_key /etc/ssl/private/localhost.key;

    location /api/ { proxy_pass http://api/; }
    location /     { proxy_pass http://web/; }
  }
}
